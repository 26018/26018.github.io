---
title: 键值获取与设置
tags: C语言
data: 2020-05-24
layout: post
renderNumberedHeading: true
grammar_cjkRuby: true
excerpt_separator: <!--more-->
---
<p align="center"></p>
<!--more-->
 # config文本内容      
admin:明月光*      
处理器:Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz 2.30GHz*      
系统类型:64位操作系统，基于 x64 的处理器*      
Windows版本:Windows 10 企业版*       
System_version:15.487*      


``` c++   
#include <stdio.h>
#include <io.h>
#include <string.h> 
#define MAX 100
typedef struct config
{
	char admin[MAX];
	char password[MAX];
}Config;
//1.接受数据的数组，2.匹配的设置名称，3.配置文件名 
bool Get_key(char Rec_arr[],char SettingName[],char FileName[])
{
	FILE *fp = fopen(FileName,"r");
	if(fp == NULL)
		perror(FileName); 
	int i; 
	char ch,Setting_Name[MAX],rb[1000];
	while(!feof(fp))
	{
		i = 0;
		memset(Setting_Name,'\0',sizeof(Setting_Name));
		while((ch = fgetc(fp)) != ':' && !feof(fp))  //不是冒号并且没有到文件末尾 
		{
			Setting_Name[i++] = ch;
		}
		if(strcmp(SettingName,Setting_Name)!=0)
		{
			memset(rb,'\0',sizeof(rb));
			fgets(rb,1000,fp);
			continue;
		}
		else
		{
			i=0;
			while((ch = fgetc(fp)) != '*')
			{
				Rec_arr[i++] = ch;
			}
			Rec_arr[i] = '\0';
			fclose(fp);
			return true;  
		}
	}
	fclose(fp); 
	return false;   
}
//1.键名，2.键值，3.配置文件名 
bool Put_key(char key[],char value[],char FileName[]) 
{
	char rb[100];
	if(Get_key(rb,key,FileName) != false)
		return false; 
	FILE *fp = fopen(FileName,"a");
	if(fp == NULL)
		perror(FileName);
	char key_and_value[MAX*2];
	memset(key_and_value,'\0',sizeof(key_and_value));
	strcat(key_and_value,key);
	strcat(key_and_value,":");
	strcat(key_and_value,value);
	strcat(key_and_value,"*");
	fputs(key_and_value,fp);
	fputc('\n',fp);
	fclose(fp);
	return true;
}
void read(char str[][MAX],char FileName[])
{
	FILE *fp = fopen(FileName,"r");
	int i=0;
	while(!feof(fp))
	{
		fgets(str[i],1000,fp);
		printf("\t%s",str[i++]);
	}
	fclose(fp);
}
int main()
{
//	char str[MAX];
//	Get_key(str,"系统类型","config.txt");
//	printf("%s",str); 
//	Put_key("config","配置文件","config.txt");
//	printf("\n运行结束\t%d\n",x);

	char str[MAX][MAX];
	read(str,"config.txt");
	return 0;
 } 
 
```

